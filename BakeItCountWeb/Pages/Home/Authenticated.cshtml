@page "/Authenticated"
@using BakeItCountWeb.DTOs

@model BakeItCountWeb.Pages.Home.AuthenticatedModel
@{
}

<style>
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @@keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.05);
        }
    }

    @@keyframes shimmer {
        0% {
            background-position: -1000px 0;
        }

        100% {
            background-position: 1000px 0;
        }
    }

    @@keyframes bounce {
        0%, 100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-10px);
        }
    }

    .fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
    }

    .slide-in-left {
        animation: slideInLeft 0.6s ease-out forwards;
    }

    .delay-100 {
        animation-delay: 0.1s;
        opacity: 0;
    }

    .delay-200 {
        animation-delay: 0.2s;
        opacity: 0;
    }

    .delay-300 {
        animation-delay: 0.3s;
        opacity: 0;
    }

    .delay-400 {
        animation-delay: 0.4s;
        opacity: 0;
    }

    .hover-lift {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

    .button-shine {
        position: relative;
        overflow: hidden;
    }

        .button-shine::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .button-shine:hover::before {
            left: 100%;
        }

    .notification-card {
        animation: slideInLeft 0.6s ease-out forwards;
        background: linear-gradient(135deg, #FF9E7A 0%, #FF8C61 100%);
        position: relative;
        overflow: hidden;
    }

        .notification-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

    .success-card {
        background: linear-gradient(135deg, #86C6A5 0%, #6FB894 100%);
        position: relative;
        overflow: hidden;
    }

        .success-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            background-size: 200% 200%;
            animation: shimmer 3s ease-in-out infinite;
        }

    .ranking-item {
        transition: all 0.3s ease;
        position: relative;
    }

        .ranking-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: linear-gradient(90deg, rgba(134, 198, 165, 0.1), transparent);
            transition: width 0.3s ease;
            border-radius: 9999px;
        }

        .ranking-item:hover::before {
            width: 100%;
        }

        .ranking-item:hover {
            transform: translateX(8px);
            border-color: #86C6A5;
        }

    .star-icon {
        animation: bounce 2s ease-in-out infinite;
    }

    .cake-icon {
        transition: transform 0.3s ease;
    }

        .cake-icon:hover {
            transform: rotate(10deg) scale(1.1);
        }

    @@keyframes drawBorder {
        0% {
            stroke-dashoffset: 1000;
        }

        100% {
            stroke-dashoffset: 0;
        }
    }

    @@keyframes fillBackground {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @@keyframes confettiFall {
        0% {
            transform: translateY(-100%) rotate(0deg);
            opacity: 1;
        }

        100% {
            transform: translateY(400px) rotate(360deg);
            opacity: 0;
        }
    }

    .success-card-animated {
        position: relative;
        background: transparent;
    }

        .success-card-animated svg.border-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .success-card-animated .border-path {
            fill: none;
            stroke: #86C6A5;
            stroke-width: 3;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawBorder 1.5s ease-out forwards;
        }

        .success-card-animated .background-fill {
            opacity: 0;
            animation: fillBackground 0.5s ease-out 1.5s forwards;
        }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 0;
        animation: confettiFall 2s ease-out forwards;
    }

        .confetti:nth-child(1) {
            left: 10%;
            animation-delay: 1.6s;
            background: #FF9E7A;
        }

        .confetti:nth-child(2) {
            left: 20%;
            animation-delay: 1.7s;
            background: #86C6A5;
        }

        .confetti:nth-child(3) {
            left: 30%;
            animation-delay: 1.65s;
            background: #FFD700;
        }

        .confetti:nth-child(4) {
            left: 40%;
            animation-delay: 1.75s;
            background: #FF6B9D;
        }

        .confetti:nth-child(5) {
            left: 50%;
            animation-delay: 1.8s;
            background: #4ECDC4;
        }

        .confetti:nth-child(6) {
            left: 60%;
            animation-delay: 1.7s;
            background: #FF9E7A;
        }

        .confetti:nth-child(7) {
            left: 70%;
            animation-delay: 1.85s;
            background: #FFD700;
        }

        .confetti:nth-child(8) {
            left: 80%;
            animation-delay: 1.65s;
            background: #86C6A5;
        }

        .confetti:nth-child(9) {
            left: 90%;
            animation-delay: 1.75s;
            background: #FF6B9D;
        }

        .confetti:nth-child(10) {
            left: 15%;
            animation-delay: 1.9s;
            background: #4ECDC4;
        }

        .confetti:nth-child(11) {
            left: 25%;
            animation-delay: 1.8s;
            background: #FF9E7A;
        }

        .confetti:nth-child(12) {
            left: 35%;
            animation-delay: 1.7s;
            background: #FFD700;
        }

        .confetti:nth-child(13) {
            left: 45%;
            animation-delay: 1.85s;
            background: #86C6A5;
        }

        .confetti:nth-child(14) {
            left: 55%;
            animation-delay: 1.65s;
            background: #FF6B9D;
        }

        .confetti:nth-child(15) {
            left: 65%;
            animation-delay: 1.9s;
            background: #4ECDC4;
        }

        .confetti:nth-child(16) {
            left: 75%;
            animation-delay: 1.75s;
            background: #FF9E7A;
        }

        .confetti:nth-child(17) {
            left: 85%;
            animation-delay: 1.8s;
            background: #FFD700;
        }

        .confetti:nth-child(18) {
            left: 95%;
            animation-delay: 1.7s;
            background: #86C6A5;
        }

        .confetti:nth-child(19) {
            left: 5%;
            animation-delay: 1.85s;
            background: #FF6B9D;
        }

        .confetti:nth-child(20) {
            left: 50%;
            animation-delay: 1.65s;
            background: #4ECDC4;
        }

    .success-message {
        opacity: 0;
        animation: fadeInUp 0.8s ease-out 3.6s forwards;
    }

    .glass-effect {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .pair-card {
        background: linear-gradient(135deg, rgba(255, 158, 122, 0.1) 0%, rgba(255, 158, 122, 0.05) 100%);
        border: 4px solid #FF9E7A;
        box-shadow: 0 8px 32px rgba(255, 158, 122, 0.2);
        transition: all 0.3s ease;
    }

        .pair-card:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 48px rgba(255, 158, 122, 0.3);
        }

    @@media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>

<div class="mx-auto my-6 md:my-10 px-4 md:px-0">
    <h1 class="font-bungee text-peach text-2xl md:text-4xl text-center fade-in-up"> DUPLA DA SEMANA </h1>

    <div class="pair-card rounded-2xl flex flex-col font-bold text-peach text-xl md:text-2xl text-center p-4 max-w-2xl mx-auto my-4 fade-in-up delay-100">
        <span> @Model.PairUser1.Name </span>
        <span> & </span>
        <span> @Model.PairUser2.Name</span>
    </div>

    @{
        bool isUserInPair = Model.CurrentUser.UserId == Model.Pair.UserId1
        || Model.CurrentUser.UserId == Model.Pair.UserId2;
        bool isConfirmed = Model.NextSchedule?.Confirmed ?? false;
    }

    @if (isUserInPair && !isConfirmed)
    {
        <div class="flex justify-center my-10 md:my-20 fade-in-up delay-200">
            <div class="flex flex-col md:flex-row text-center gap-4 md:gap-0 w-full max-w-md md:max-w-none px-4 md:px-0">
                <a class="bg-peach text-beige rounded-2xl font-bungee px-4 py-3 md:py-2 text-2xl md:text-4xl md:mx-2
                   hover-lift button-shine cursor-pointer"
                   href="@($"swap/create/{Model.NextSchedule.ScheduleId}")">
                    TROCAR
                </a>

                <form method="post" asp-page-handler="ConfirmSchedule" class="w-full md:w-auto">
                    <input type="hidden" name="ScheduleId" value="@Model.NextSchedule.ScheduleId" />

                    <button type="submit"
                            class="w-full md:w-auto bg-cocoa text-beige rounded-2xl font-bungee px-4 py-3 md:py-2 text-2xl md:text-4xl md:mx-2
                            hover-lift button-shine cursor-pointer">
                        CONFIRMAR
                    </button>
                </form>
            </div>
        </div>
    }
    else if (isUserInPair && isConfirmed)
    {
        if (Model.PurchaseId == 0)
        {
            <div class="my-10 md:my-20 mx-auto text-center px-4 fade-in-up delay-200">
                <a class="inline-block bg-cocoa text-beige rounded-2xl font-bungee px-4 py-3 md:py-2 text-2xl md:text-4xl
                   hover-lift button-shine cursor-pointer" href="@($"purchase/create/{Model.NextSchedule.ScheduleId}")">
                    REGISTRAR COMPRA
                </a>
            </div>
        }
        else
        {
            <div class="my-10 md:my-20 mx-auto text-center px-4 fade-in-up delay-200">
                <a class="inline-block bg-beige border-3 border-cocoa text-cocoa rounded-2xl font-bungee px-4 py-3 md:py-2 text-2xl md:text-4xl
                   hover-lift button-shine cursor-pointer" href="@($"purchase/{Model.PurchaseId}")">
                    DETALHES DA COMPRA
                </a>
            </div>
        }

        <div class="success-card-animated text-beige p-4 rounded-2xl mx-auto max-w-2xl my-10 md:my-20 relative overflow-hidden">
            <svg class="border-animation" xmlns="http://www.w3.org/2000/svg">
                <rect class="border-path" x="1.5" y="1.5" width="calc(100% - 3px)" height="calc(100% - 3px)" rx="16" ry="16" />
            </svg>

            <div class="background-fill absolute inset-0 rounded-2xl" style="background: linear-gradient(135deg, #86C6A5 0%, #6FB894 100%); z-index: 0;"></div>

            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>
            <div class="confetti rounded-full"></div>

            <div class="flex gap-2 items-start relative z-10 success-message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-8 md:size-10 flex-shrink-0 cake-icon">
                    <path d="m15 1.784-.796.795a1.125 1.125 0 1 0 1.591 0L15 1.784ZM12 1.784l-.796.795a1.125 1.125 0 1 0 1.591 0L12 1.784ZM9 1.784l-.796.795a1.125 1.125 0 1 0 1.591 0L9 1.784ZM9.75 7.547c.498-.021.998-.035 1.5-.042V6.75a.75.75 0 0 1 1.5 0v.755c.502.007 1.002.021 1.5.042V6.75a.75.75 0 0 1 1.5 0v.88l.307.022c1.55.117 2.693 1.427 2.693 2.946v1.018a62.182 62.182 0 0 0-13.5 0v-1.018c0-1.519 1.143-2.829 2.693-2.946l.307-.022v-.88a.75.75 0 0 1 1.5 0v.797ZM12 12.75c-2.472 0-4.9.184-7.274.54-1.454.217-2.476 1.482-2.476 2.916v.384a4.104 4.104 0 0 1 2.585.364 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 3.67 0 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 3.67 0 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 2.585-.364v-.384c0-1.434-1.022-2.7-2.476-2.917A49.138 49.138 0 0 0 12 12.75ZM21.75 18.131a2.604 2.604 0 0 0-1.915.165 4.104 4.104 0 0 1-3.67 0 2.605 2.605 0 0 0-2.33 0 4.104 4.104 0 0 1-3.67 0 2.605 2.605 0 0 0-2.33 0 4.104 4.104 0 0 1-3.67 0 2.604 2.604 0 0 0-1.915-.165v2.494c0 1.035.84 1.875 1.875 1.875h15.75c1.035 0 1.875-.84 1.875-1.875v-2.494Z" />
                </svg>

                <p class="text-lg md:text-xl font-bungee leading-relaxed">
                    Uhull, @(Model.PairUser1.Name) e @(Model.PairUser2.Name) confirmaram o bolo.
                </p>
            </div>
        </div>
    }
    else if (isConfirmed)
    {
        <div class="success-card text-beige p-4 rounded-2xl mx-auto max-w-2xl my-10 md:my-20 fade-in-up delay-200">
            <div class="flex gap-2 items-start relative z-10">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-8 md:size-10 flex-shrink-0 cake-icon">
                    <path d="m15 1.784-.796.795a1.125 1.125 0 1 0 1.591 0L15 1.784ZM12 1.784l-.796.795a1.125 1.125 0 1 0 1.591 0L12 1.784ZM9 1.784l-.796.795a1.125 1.125 0 1 0 1.591 0L9 1.784ZM9.75 7.547c.498-.021.998-.035 1.5-.042V6.75a.75.75 0 0 1 1.5 0v.755c.502.007 1.002.021 1.5.042V6.75a.75.75 0 0 1 1.5 0v.88l.307.022c1.55.117 2.693 1.427 2.693 2.946v1.018a62.182 62.182 0 0 0-13.5 0v-1.018c0-1.519 1.143-2.829 2.693-2.946l.307-.022v-.88a.75.75 0 0 1 1.5 0v.797ZM12 12.75c-2.472 0-4.9.184-7.274.54-1.454.217-2.476 1.482-2.476 2.916v.384a4.104 4.104 0 0 1 2.585.364 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 3.67 0 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 3.67 0 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 2.585-.364v-.384c0-1.434-1.022-2.7-2.476-2.917A49.138 49.138 0 0 0 12 12.75ZM21.75 18.131a2.604 2.604 0 0 0-1.915.165 4.104 4.104 0 0 1-3.67 0 2.605 2.605 0 0 0-2.33 0 4.104 4.104 0 0 1-3.67 0 2.605 2.605 0 0 0-2.33 0 4.104 4.104 0 0 1-3.67 0 2.604 2.604 0 0 0-1.915-.165v2.494c0 1.035.84 1.875 1.875 1.875h15.75c1.035 0 1.875-.84 1.875-1.875v-2.494Z" />
                </svg>

                <p class="text-lg md:text-xl font-bungee leading-relaxed">
                    Uhull, @(Model.PairUser1.Name) e @(Model.PairUser2.Name) confirmaram o bolo.
                </p>
            </div>
        </div>
    }
    else
    {
        <div class="my-10 md:my-20 mx-auto text-center px-4 fade-in-up delay-200">
            <a class="inline-block bg-cocoa text-beige rounded-2xl font-bungee px-4 py-3 md:py-2 text-2xl md:text-4xl
               hover-lift button-shine cursor-pointer" href="/flavor/vote">
                VOTAR
            </a>
        </div>
    }

    @if (Model.SwapRequest.SwapId > 0
    && (Model.SwapRequest.TargetSchedule?.Pair?.UserId1 == Model.CurrentUser.UserId
    || Model.SwapRequest.TargetSchedule?.Pair?.UserId2 == Model.CurrentUser.UserId) && Model.SwapRequest.Status == SwapStatus.PENDING)
    {
        <div class="notification-card text-beige p-4 rounded-2xl mx-auto max-w-2xl">
            <div class="flex gap-2 items-start relative z-10">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-8 flex-shrink-0">
                    <path d="M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z" />
                    <path fill-rule="evenodd" d="M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z" clip-rule="evenodd" />
                </svg>

                <div>
                    <p class="text-lg md:text-xl font-bungee leading-relaxed">
                        Ei! Parece que @(Model.Pair.User1.Name) e @(Model.Pair.User2.Name) querem trocar a vez do bolo com você.
                    </p>
                    <a href="@($"swap/respond/{Model.SwapRequest.SwapId}")" class="underline text-base md:text-lg font-semibold hover:text-white transition-colors">
                        Clique para ver os detalhes e faça sua escolha!
                    </a>
                </div>
            </div>
        </div>
    }
</div>

<div class="mx-auto my-6 md:my-10 px-4 md:px-0">
    <h1 class="font-bungeeInline text-4xl md:text-6xl text-left text-cocoa fade-in-up"> VOTAÇÃO </h1>
    <p class="text-cocoa text-base md:text-lg font-semibold text-left mx-auto my-6 md:my-10 fade-in-up delay-100">
        E os sabores mais votados para essa semana é....
    </p>
    <ul class="my-6 md:my-10 text-lg md:text-xl font-bold flex flex-col gap-2 max-w-6xl">
        @for (int i = 0; i < Model.Flavors.Count; i++)
        {
            var flavor = Model.Flavors[i];
            var delayClass = $"delay-{(i + 2) * 100}";
            <li class="ranking-item py-2 px-4 md:px-6 border-cocoa border-2 rounded-full flex gap-2 items-center fade-in-up @delayClass">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6 md:size-8 text-peach flex-shrink-0 @(i < 3 ? "star-icon" : "")">
                    <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clip-rule="evenodd" />
                    <text x="50%" y="55%" text-anchor="middle" dominant-baseline="middle"
                          font-size="10" fill="white" font-family="Arial">
                        @(i + 1)
                    </text>
                </svg>
                <span class="text-cocoa truncate flex-1 min-w-0"> @flavor.Name </span>
                <span class="text-mint ml-auto whitespace-nowrap text-sm md:text-xl"> @flavor.Votes VOTOS </span>
            </li>
        }
    </ul>
    <a href="/flavor/vote" class="text-cocoa text-base md:text-lg font-semibold text-left hover:text-mint mx-auto my-6 md:my-10 underline block transition-colors fade-in-up delay-400">
        Clique aqui e participe da votação
    </a>
</div>