@page "/purchase/create/{scheduleId}"
@model BakeItCountWeb.Pages.Purchase.CreateModel
@{
}

<style>
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @@keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    @@keyframes cakeDown {
        0% {
            transform: translateY(-100px) scale(0.5);
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
        100% {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
    }

    @@keyframes cakeToCheck {
        0% {
            transform: scale(1) rotate(0deg);
            opacity: 1;
        }
        50% {
            transform: scale(0) rotate(180deg);
            opacity: 0;
        }
        100% {
            transform: scale(0) rotate(180deg);
            opacity: 0;
        }
    }

    @@keyframes checkAppear {
        0% {
            transform: scale(0) rotate(-180deg);
            opacity: 0;
        }
        50% {
            transform: scale(1.2) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: scale(1) rotate(0deg);
            opacity: 1;
        }
    }

    @@keyframes drawCheck {
        0% {
            stroke-dashoffset: 50;
        }
        100% {
            stroke-dashoffset: 0;
        }
    }

    @@keyframes pulseGreen {
        0%, 100% {
            box-shadow: 0 0 0 0 rgba(134, 198, 165, 0.7);
        }
        50% {
            box-shadow: 0 0 0 30px rgba(134, 198, 165, 0);
        }
    }

    @@keyframes slideOutRight {
        from {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        to {
            transform: translateX(150vw) scale(0.8);
            opacity: 0;
        }
    }

    .fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
    }

    .delay-100 {
        animation-delay: 0.1s;
        opacity: 0;
    }

    .delay-200 {
        animation-delay: 0.2s;
        opacity: 0;
    }

    .success-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    .success-overlay.active {
        display: flex;
    }

    .success-circle {
        width: 280px;
        height: 280px;
        background: linear-gradient(135deg, #86C6A5 0%, #6FB894 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), pulseGreen 1.5s ease-out 2s;
    }

    .icon-container {
        position: relative;
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .cake {
        position: absolute;
        animation: cakeDown 1s ease-out 0.5s forwards, cakeToCheck 0.6s ease-in 1.8s forwards;
        opacity: 0;
    }

    .check-icon {
        position: absolute;
        opacity: 0;
        animation: checkAppear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.4s forwards;
    }

    .check-icon path {
        stroke-dasharray: 50;
        stroke-dashoffset: 50;
        animation: drawCheck 0.5s ease-out 2.6s forwards;
    }

    .slide-out {
        animation: slideOutRight 1.2s ease-in 3.5s forwards;
    }

    .hover-lift {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .hover-lift:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .button-shine {
        position: relative;
        overflow: hidden;
    }

    .button-shine::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .button-shine:hover::before {
        left: 100%;
    }

    @@media (max-width: 768px) {
        .success-circle {
            width: 220px;
            height: 220px;
        }

        .icon-container {
            width: 100px;
            height: 100px;
        }

        .cake svg {
            width: 80px;
            height: 80px;
        }

        .check-icon {
            width: 100px;
            height: 100px;
        }
    }
</style>

<div class="mx-auto my-6 md:my-10 px-4 md:px-0">
    <h1 class="font-bungeeInline text-3xl md:text-6xl text-left text-cocoa fade-in-up mb-6 md:mb-10"> REGISTRAR COMPRA </h1>
    
    <div class="flex flex-col md:flex-row gap-4 md:gap-8 font-bungee text-xl md:text-4xl text-left text-peach fade-in-up delay-100">
        <h2 class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6 md:size-8 flex-shrink-0">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
            </svg>
            <span class="break-words">@Model.Schedule.WeekRef.ToString("dd/MM/yyyy")</span>
        </h2>
        
        <h2 class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6 md:size-8 flex-shrink-0">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
            </svg>
            <span class="break-words">@Model.Schedule.Pair.User1.Name & @Model.Schedule.Pair.User2.Name</span>
        </h2>
    </div>

    <form method="post" id="purchaseForm" class="max-w-2xl fade-in-up delay-200">
        <div class="my-4 md:my-6">
            <label for="PurchaseDate" class="block text-lg md:text-xl font-medium text-cocoa font-bungee mb-2">Data da Compra</label>
            <input id="PurchaseDate" name="PurchaseDate" type="datetime-local"
                   value="@Model.Schedule.WeekRef.ToString("yyyy-MM-ddTHH:mm")"
                   class="w-full rounded-2xl p-3 border-2 border-cocoa focus:border-mint focus:ring focus:ring-mint-light text-base md:text-xl text-cocoa bg-beige hover-lift transition-all" />
            <span class="text-peach text-sm md:text-xl block mt-1">
                @if (ViewData.ModelState["PurchaseDate"]?.Errors.Count > 0)
                {
                    @ViewData.ModelState["PurchaseDate"].Errors[0].ErrorMessage
                }
            </span>
        </div>

        <div class="my-4 md:my-6">
            <label for="Flavor1Id" class="block text-lg md:text-xl font-medium text-cocoa font-bungee mb-2">Sabor 1</label>
            <select id="Flavor1Id" name="Flavor1Id"
                    class="w-full rounded-2xl p-3 border-2 border-cocoa focus:border-mint focus:ring focus:ring-mint-light text-base md:text-xl text-cocoa bg-beige hover-lift transition-all">
                <option value="">Selecione um sabor</option>
                @foreach (var flavor in Model.Flavors)
                {
                    <option value="@flavor.FlavorId">@flavor.Name</option>
                }
            </select>
            <span class="text-red-500 text-sm block mt-1">
                @if (ViewData.ModelState["Flavor1Id"]?.Errors.Count > 0)
                {
                    @ViewData.ModelState["Flavor1Id"].Errors[0].ErrorMessage
                }
            </span>
        </div>

        <div class="my-4 md:my-6">
            <label for="Flavor2Id" class="block text-lg md:text-xl font-medium text-cocoa font-bungee mb-2">Sabor 2</label>
            <select id="Flavor2Id" name="Flavor2Id"
                    class="w-full rounded-2xl p-3 border-2 border-cocoa focus:border-mint focus:ring focus:ring-mint-light text-base md:text-xl text-cocoa bg-beige hover-lift transition-all">
                <option value="">Selecione um sabor</option>
                @foreach (var flavor in Model.Flavors)
                {
                    <option value="@flavor.FlavorId">@flavor.Name</option>
                }
            </select>
            <span class="text-red-500 text-sm block mt-1">
                @if (ViewData.ModelState["Flavor2Id"]?.Errors.Count > 0)
                {
                    @ViewData.ModelState["Flavor2Id"].Errors[0].ErrorMessage
                }
            </span>
        </div>

        <div class="my-4 md:my-6">
            <label for="Notes" class="block text-lg md:text-xl font-medium text-cocoa font-bungee mb-2">Observações</label>
            <textarea id="Notes" name="Notes" rows="3"
                      class="w-full rounded-2xl p-3 border-2 border-cocoa focus:border-mint focus:ring focus:ring-mint-light text-base md:text-xl text-cocoa bg-beige hover-lift transition-all"></textarea>
            <span class="text-red-500 text-sm block mt-1">
                @if (ViewData.ModelState["Notes"]?.Errors.Count > 0)
                {
                    @ViewData.ModelState["Notes"].Errors[0].ErrorMessage
                }
            </span>
        </div>

        <div class="mt-6 md:mt-8">
            <button type="submit"
                    class="w-full md:w-auto bg-mint text-beige rounded-2xl font-bungee px-6 md:px-8 py-3 md:py-4 text-2xl md:text-4xl
                    hover-lift button-shine cursor-pointer">
                Salvar
            </button>
        </div>
    </form>
</div>

<div id="successOverlay" class="success-overlay">
    <div class="success-circle" id="successCircle">
        <div class="icon-container">
            <svg class="cake" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#F5E6D3" width="100" height="100">
                <path d="m15 1.784-.796.795a1.125 1.125 0 1 0 1.591 0L15 1.784ZM12 1.784l-.796.795a1.125 1.125 0 1 0 1.591 0L12 1.784ZM9 1.784l-.796.795a1.125 1.125 0 1 0 1.591 0L9 1.784ZM9.75 7.547c.498-.021.998-.035 1.5-.042V6.75a.75.75 0 0 1 1.5 0v.755c.502.007 1.002.021 1.5.042V6.75a.75.75 0 0 1 1.5 0v.88l.307.022c1.55.117 2.693 1.427 2.693 2.946v1.018a62.182 62.182 0 0 0-13.5 0v-1.018c0-1.519 1.143-2.829 2.693-2.946l.307-.022v-.88a.75.75 0 0 1 1.5 0v.797ZM12 12.75c-2.472 0-4.9.184-7.274.54-1.454.217-2.476 1.482-2.476 2.916v.384a4.104 4.104 0 0 1 2.585.364 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 3.67 0 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 3.67 0 2.605 2.605 0 0 0 2.33 0 4.104 4.104 0 0 1 2.585-.364v-.384c0-1.434-1.022-2.7-2.476-2.917A49.138 49.138 0 0 0 12 12.75ZM21.75 18.131a2.604 2.604 0 0 0-1.915.165 4.104 4.104 0 0 1-3.67 0 2.605 2.605 0 0 0-2.33 0 4.104 4.104 0 0 1-3.67 0 2.605 2.605 0 0 0-2.33 0 4.104 4.104 0 0 1-3.67 0 2.604 2.604 0 0 0-1.915-.165v2.494c0 1.035.84 1.875 1.875 1.875h15.75c1.035 0 1.875-.84 1.875-1.875v-2.494Z" />
            </svg>
            <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="#F5E6D3" width="120" height="120">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
            </svg>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('purchaseForm');
        const overlay = document.getElementById('successOverlay');
        const circle = document.getElementById('successCircle');

        form.addEventListener('submit', function(e) {
            const flavor1 = document.getElementById('Flavor1Id').value;
            const flavor2 = document.getElementById('Flavor2Id').value;
            
            if (!flavor1 || !flavor2) {
                return;
            }

            e.preventDefault();
            
            overlay.classList.add('active');
            
            setTimeout(() => {
                circle.classList.add('slide-out');
            }, 2800);

            setTimeout(() => {
                form.submit();
            }, 4300);
        });
    });
</script>